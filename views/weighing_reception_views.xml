<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!--Todo: Configuration Tree-->
    <record model="ir.ui.view" id="view_weighing_reception_tree">
        <field name="name">weighing.reception.tree</field>
        <field name="model">weighing.reception</field>
        <field name="arch" type="xml">
            <!--#Todo
            Traduction No spanish-->
            <tree string="Lista de Configuraciones">
                <field name="name" decoration-bf="True" />
                <field
                    name="state"
                    optional="show"
                    widget="badge"
                    decoration-success="state == 'received'"
                    decoration-warning="state == 'out'"
                    decoration-info="state == 'selection'"
                />
                <field
                    name="farmer_id"
                    optional="show"
                    widget="res_partner_many2one"
                />
                <field
                    name="supplier_id"
                    optional="show"
                    widget="res_partner_many2one"
                />
                <field
                    name="vehicle_license_plate"
                    optional="show"
                    decoration-bf="True"
                    decoration-it="True"
                />
                <field
                    name="driver_id"
                    optional="show"
                    widget="res_partner_many2one"
                />
                <field name="datetime_in" optional="show" />
                <field name="datetime_out" optional="show" />
                <field
                    name="employee_id"
                    optional="show"
                    widget="many2one_avatar_employee"
                />
                <field
                    name="activity_ids"
                    optional="show"
                    widget="list_activity"
                />
                <field
                    name="vehicle_uom_id"
                    optional="show"
                    decoration-bf="True"
                    decoration-it="True"
                />
                <field name="input_weight" optional="show" />
                <field name="output_weight" optional="show" />
                <field name="product_weight" optional="show" />
                <field
                    name="product_id"
                    optional="show"
                    decoration-bf="True"
                />
                <field name="qty_basket" optional="show" />
                <field
                    name="product_uom_id"
                    optional="show"
                    decoration-bf="True"
                    decoration-it="True"
                />
            </tree>
        </field>
    </record>

    <record id="view_weighing_reception_form" model="ir.ui.view">
        <field name="name">weighing.reception.form</field>
        <field name="model">weighing.reception</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button
                        name="action_in"
                        string="Check-in"
                        type="object"
                        attrs="{'invisible': [('state', 'not in', ['draft'])]}"
                    />
                    <button
                        name="action_out"
                        string="Entrar"
                        type="object"
                        attrs="{'invisible': [('state', 'not in', ['in'])]}"
                    />
                    <button
                        name="action_selection"
                        type="object"
                        string="Selection"
                        attrs="{'invisible': [('state', 'not in', ['out'])]}"
                    />
                    <button
                        name="action_received"
                        string="Recibir"
                        type="object"
                        attrs="{'invisible': [('state', 'not in', ['selection'])]}"
                    />
                    <button
                        name="action_transfer"
                        string="Crear Compra"
                        type="object"
                        attrs="{
                            'invisible': [
                                '|',
                                ('state', 'not in', ['received']), 
                                ('transfer_count', '&gt;', 0)
                            ]
                        }"
                    />
                    <field
                        name="state"
                        widget="statusbar"
                        statusbar_visible="draft,in,out,selection,received"
                    />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            name="action_view_transfer"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-pencil-square-o"
                            attrs="{'invisible': [('transfer_count', '=', 0)]}"
                        >
                            <field
                                name="transfer_count"
                                widget="statinfo"
                                string="Transferencias"
                            />
                        </button>
                        <button
                            name="action_open_receptions"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-truck"
                            attrs="{'invisible': [('reception_counts', '=', 0)]}"
                        >
                            <field name="reception_counts" widget="statinfo" />
                        </button>
                        <button
                            name="action_open_orders"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-first-order"
                            attrs="{'invisible': [('purchase_order_counts', '=', 0)]}"
                        >
                            <field name="purchase_order_counts" widget="statinfo" />
                        </button>
                    </div>
                    <div class="oe_title">
                        <label
                            for="name"
                            string="Número"
                            style="color:#c8c8c8"
                        />
                        <h1 class="mt0">
                            <field name="name" readonly="1" />
                        </h1>
                    </div>
                    <group string="Datos generales">
                        <group>
                            <field
                                name="datetime_in"
                                attrs="{
                                    'readonly': [('state', '!=', 'in')],
                                    'required': [('state','=','in')]
                                }"
                            />
                            <field
                                name="datetime_out"
                                attrs="{
                                    'readonly': [('state', '!=', 'out')], 
                                    'required': [('state','=','out')]
                                }"
                            />
                            <field
                                name="farmer_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                                widget="res_partner_many2one"
                            />
                            <field
                                name="supplier_id"
                                domain="[('supplier_rank', '>', 0)]"
                                context="{'default_supplier_rank': 1}"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                                widget="res_partner_many2one"
                            />
                            <field
                                name="vehicle_license_plate"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                            />
                            <field
                                name="driver_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                                widget="res_partner_many2one"
                            />
                        </group>
                        <group>
                            <field
                                name="employee_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                                widget="many2one_avatar_employee"
                            />
                            <field
                                name="vehicle_uom_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'in')],
                                    'required': [('state','=','in')]
                                }"
                            />
                            <field
                                name="input_weight"
                                attrs="{
                                    'readonly': [('state', '!=', 'in')], 
                                    'required': [('state','=','in')]
                                }"
                            />
                            <field
                                name="output_weight"
                                attrs="{
                                    'readonly': [('state', '!=', 'out')], 
                                    'required': [('state','=','in')]
                                }"
                            />
                            <field
                                name="product_weight"
                                attrs="{'required': [('state','=',['out'])]}"
                            />
                        </group>
                    </group>
                    <group
                        name="checkers"
                        attrs="{'invisible': [('state', 'not in', ['selection', 'received'])]}"
                        string="Habilitar Descuentos no contables y descuentos de canastillas"
                    >
                        <group>
                            <field name="discount_product" widget="boolean_toggle" />
                        </group>
                        <group>
                            <field name="weight_basket" widget="boolean_toggle" />
                        </group>
                    </group>
                    <group
                        name="product_discount"
                        string="Descuento del producto"
                        attrs="{
                            'invisible': [
                                '|',
                                ('state', 'not in', ['selection', 'received']),
                                ('discount_product', '=', False)
                            ]
                        }"
                    >
                        <label for="not_countable_weight" />
                        <div>
                            <field
                                name="not_countable_weight"
                                attrs="{
                                        'readonly': [('state', 'not in', ['out','selection'])], 
                                        'required': [('weight_basket', '=', True)]
                                    }"
                                class="oe_inline"
                            />
                            <field
                                name="not_countable_weight_uom_name"
                                attrs="{
                                        'required': [('weight_basket', '=', True)]
                                    }"
                                class="oe_inline"
                            />
                        </div>
                    </group>
                    <group
                        name="Canastillas"
                        string="Canastillas"
                        attrs="{
                            'invisible': [
                                '|',
                                ('state', 'not in', ['selection', 'received']),
                                ('weight_basket', '=', False)
                            ]
                        }"
                    >
                        <group>
                            <field
                                name="qty_basket"
                                attrs="{
                                    'readonly': [('state', 'not in', ['selection', 'received'])], 
                                    'required': [('weight_basket', '=', True)]
                                }"
                            />
                            <field
                                name="basket_product_id"
                                attrs="{
                                    'readonly': [('state', 'not in', ['out','selection'])], 
                                    'required': [('weight_basket', '=', True)]
                                }"
                                domain="[('available_in_stock', '=', True)]"
                            />
                        </group>
                        <group>
                            <label for="basket_product_weight" />
                            <div>
                                <field
                                    name="basket_product_weight_unit"
                                    attrs="{
                                        'readonly': [('state', 'not in', ['out','selection'])], 
                                        'required': [('weight_basket', '=', True)]
                                    }"
                                    class="oe_inline"
                                />
                                <field
                                    name="basket_product_weight"
                                    attrs="{
                                        'readonly': True,
                                        'required': [('weight_basket', '=', True)]
                                    }"
                                    class="oe_inline"
                                />
                                <field
                                    name="basket_uom_name"
                                    attrs="{
                                        'required': [('weight_basket', '=', True)]
                                    }"
                                    class="oe_inline"
                                    placeholder="Agregar Medida. Por ejemplo: kg"
                                />
                            </div>
                        </group>
                    </group>
                    <group>
                        <group string="Datos del producto">
                            <field
                                name="categ_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draf')]
                                }"
                            />
                            <field
                                name="product_id"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                                domain="[('categ_id', '=', categ_id)]"
                            />
                            <field
                                name="product_name"
                                attrs="{
                                    'readonly': [('state', '!=', 'draft')],
                                    'required': [('state','=','draft')]
                                }"
                            />
                            <field
                                name="product_uom_id"
                                attrs="{
                                    'readonly': [('state', 'not in', ['out','received'])], 
                                    'required': [('state','=','out')]
                                }"
                            />
                        </group>
                        <group string="Datos para transferencia">
                            <field name="active" invisible="1" />
                            <field
                                name="location_id"
                                attrs="{'required': [('state', '=', 'received')]}"
                            />
                            <field
                                name="location_dest_id"
                                attrs="{'required': [('state', '=', 'received')]}"
                            />
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>

    <!--Todo:
    Configuration action-->
    <record model="ir.actions.act_window" id="action_weighing_reception">
        <field name="name">Recepción</field>
        <field name="res_model">weighing.reception</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crea una nueva recepción de peso
            </p>
        </field>
    </record>

    <!--Todo:
    Configuration Menú-->
    <menuitem
        id="menu_purchase_weighing_reception"
        action="action_weighing_reception"
        parent="purchase.menu_procurement_management"
        sequence="1"
    />

    <menuitem
        action="purchase.purchase_rfq"
        id="purchase.menu_purchase_rfq"
        parent="purchase.menu_procurement_management"
        sequence="3"
    />

</odoo>